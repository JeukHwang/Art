function initPhysics(physics) {
    const gravity = planck.Vec2(0.0, -10.0);
    const world = planck.World({ gravity: gravity });
    const leftWall = world.createBody();
    leftWall.createFixture(planck.Edge(planck.Vec2(-physics.width / 2, -physics.height / 2), planck.Vec2(-physics.width / 2, physics.height / 2)));
    const rightWall = world.createBody();
    rightWall.createFixture(planck.Edge(planck.Vec2(physics.width / 2, -physics.height / 2), planck.Vec2(physics.width / 2, physics.height / 2)));
    const lowerWall = world.createBody();
    lowerWall.createFixture(planck.Edge(planck.Vec2(-physics.width / 2, -physics.height / 2), planck.Vec2(physics.width / 2, -physics.height / 2)));
    // const upperLeftWall = world.createBody();
    // upperLeftWall.createFixture(planck.Edge(planck.Vec2(-physics.width / 2, physics.height / 2), planck.Vec2(-physics.width / 4, physics.height / 2)));
    // const upperRightWall = world.createBody();
    // upperRightWall.createFixture(planck.Edge(planck.Vec2(physics.width / 4, physics.height / 2), planck.Vec2(physics.width / 2, physics.height / 2)));
    physics.world = world;
}

function createCircle(physics) {
    const box = physics.world.createBody().setDynamic();
    const radius = physics.random() > 0.4
        ? (6 / (1 + Math.exp((physics.counter.total / 60 - 20 + physics.random() * 5) / 6)) + 2)
        : (8 * physics.random() + 1);
    box.createFixture(planck.Circle(radius), { density: 1.0, friction: 0.2, restitution: 0.5 });
    box.setPosition(planck.Vec2(physics.random(-2, 2), physics.height / 2 + radius));
    box.setUserData({ id: physics.counter.circle, radius: radius });
    physics.counter.circle += 1;
}

function savePhysics(physics) {
    console.log(physics.counter.total);
    const bodies = [];
    for (let body = physics.world.getBodyList(); body; body = body.getNext()) {
        let data = body.getUserData();
        let pos = body.getPosition();
        let angle = body.getAngle();
        if (data !== null) {
            let { id, radius } = data;
            bodies.push({ id, radius, x: pos.x, y: pos.y, angle });
        }
    }
    physics.flag.sleep = true;
    console.log(bodies);
}

function updatePhysics(physics) {
    const timeStep = 1 / physics.fps;
    physics.world.step(timeStep, physics.velocityIterations, physics.positionIterations);
    let sleeping = true;
    for (var b = physics.world.getBodyList(); b; b = b.getNext()) {
        if (b.isDynamic() && b.isAwake()) { sleeping = false; }
    }
    if (!physics.flag.sleep && sleeping && physics.counter.circle == physics.counter.maxCircle) {
        savePhysics(physics);
    }
    if (sleeping || physics.counter.lastCreate > 100) {
        if (physics.counter.circle < physics.counter.maxCircle) {
            createCircle(physics);
            physics.counter.lastCreate = 0;
        }
    }
    physics.counter.lastCreate += 1;
    physics.counter.total += 1;
}

function initRender(p5, render, physics) {
    p5.createCanvas(render.width, render.height);
    p5.frameRate(render.fps);
    p5.noStroke();
    p5.strokeWeight(0);
    p5.imageMode(p5.CENTER);
    p5.pixelDensity(p5.displayDensity());

    render.asset.resize(render.width, render.height);
    render.sleep_body_info.forEach((body_info) => {
        const { id, radius: radius_ } = body_info;
        const radius = render.convert.length(radius_);
        const size = 2 * radius;
        const pos = render.convert.pos(body_info);
        const assetClip = p5.createImage(size, size);
        assetClip.copy(render.asset, pos.x - radius, pos.y - radius, size, size, 0, 0, size, size);
        let shape = p5.createGraphics(size, size);
        shape.circle(radius, radius, size - 2);
        assetClip.mask(shape);
        render.graphics[id] = assetClip;
    });
}

function updateRender(p5, render, physics) {
    p5.background(220);
    for (let body = physics.world.getBodyList(); body; body = body.getNext()) {
        let data = body.getUserData();
        let pos = body.getPosition();
        if (data !== null) {
            let { id, radius } = data;
            let body_info = render.sleep_body_info[89 - id];
            let pos_ = render.convert.pos(pos);
            let angle = body_info.angle - body.getAngle();
            let radius_ = render.convert.length(radius);
            if (render.useImage) {
                p5.push();
                p5.translate(pos_.x, pos_.y);
                p5.rotate(angle);
                p5.image(render.graphics[id], 0, 0, 2 * radius_, 2 * radius_);
                p5.pop();
            } else {
                p5.ellipse(pos_.x, pos_.y, 2 * radius_, 2 * radius_);
            }
        }
    }
}

const sketch = (p5) => {
    const physics_ = {
        fps: 30, seed: 6, random: (min = 0, max = 1) => {
            physics_.seed = (physics_.seed * 9301 + 49297) % 233280;
            return min + (physics_.seed / 233280) * (max - min);
        },
        width: 72.5, height: 108,
        velocityIterations: 10, positionIterations: 8,
        world: null,
        counter: { total: 0, lastCreate: 0, circle: 0, maxCircle: 90 },
        flag: { sleep: false }
    };
    const render_ = {
        ratio: 5, convert: {
            pos: (position) => {
                return {
                    x: Math.round(position.x * render_.ratio + render_.width / 2),
                    y: Math.round(-position.y * render_.ratio + render_.height / 2)
                };
            },
            length: (length) => Math.round(length * render_.ratio)
        },
        width: null, height: null,
        fps: physics_.fps,
        asset: null, sleep_body_info: null,
        graphics: {}, useImage : true
    };
    render_.width = render_.convert.length(physics_.width);
    render_.height = render_.convert.length(physics_.height);
    render_.sleep_body_info = [
        {
            "id": 89,
            "radius": 2.000000001334325,
            "x": 21.731789462060007,
            "y": 21.784798158173302,
            "angle": -6.090764507143929
        },
        {
            "id": 88,
            "radius": 2.121673525377229,
            "x": -15.68581920608561,
            "y": 44.371430665324965,
            "angle": 9.982653322579434
        },
        {
            "id": 87,
            "radius": 2.00000000262591,
            "x": -18.1508943025971,
            "y": 41.0747517562509,
            "angle": 5.700587820180361
        },
        {
            "id": 86,
            "radius": 5.638751714677641,
            "x": -0.019961569883141524,
            "y": 45.02442375465214,
            "angle": -0.22828533815251334
        },
        {
            "id": 85,
            "radius": 7.036179698216735,
            "x": -9.990219636473114,
            "y": 37.20660745882464,
            "angle": 0.8131321451910777
        },
        {
            "id": 84,
            "radius": 2.000000005571254,
            "x": -17.314919917463797,
            "y": 31.141373316729755,
            "angle": 7.668699613442836
        },
        {
            "id": 83,
            "radius": 8.442146776406036,
            "x": -26.888904509672958,
            "y": 35.36731497327092,
            "angle": 4.129494179946391
        },
        {
            "id": 82,
            "radius": 2.000000015817777,
            "x": -34.24725342415409,
            "y": 27.968744893625818,
            "angle": 17.209120247469492
        },
        {
            "id": 81,
            "radius": 2.0000000120272383,
            "x": -13.8994633070385,
            "y": 29.067698654104387,
            "angle": 6.457172542028277
        },
        {
            "id": 80,
            "radius": 5.0788751714677645,
            "x": -19.125583990353316,
            "y": 24.30333496022092,
            "angle": 5.057087278242146
        },
        {
            "id": 79,
            "radius": 2.0000000184905953,
            "x": -23.436738678406694,
            "y": 18.698635617729842,
            "angle": 14.891275380180554
        },
        {
            "id": 78,
            "radius": 5.632990397805212,
            "x": -30.612532616311352,
            "y": 21.264473728195757,
            "angle": 4.979549380857732
        },
        {
            "id": 77,
            "radius": 2.000000065917234,
            "x": -25.7153008326338,
            "y": 15.402117596974273,
            "angle": 17.94763745048804
        },
        {
            "id": 76,
            "radius": 8.779698216735254,
            "x": 7.08026183268764,
            "y": 32.481185647742265,
            "angle": 0.05562259109774236
        },
        {
            "id": 75,
            "radius": 2.0000000590488325,
            "x": 30.67240788059007,
            "y": 24.314185743360838,
            "angle": -19.94476851199645
        },
        {
            "id": 74,
            "radius": 2.0000001203169604,
            "x": 23.65159764887841,
            "y": 18.281921128351833,
            "angle": -17.708150097326794
        },
        {
            "id": 73,
            "radius": 2.0000002137772395,
            "x": 34.24499978622278,
            "y": 22.516313571419836,
            "angle": -20.486494643724978
        },
        {
            "id": 72,
            "radius": 4.184224965706447,
            "x": 29.829836385717734,
            "y": 18.19281076530084,
            "angle": -5.878854740007603
        },
        {
            "id": 71,
            "radius": 1.9890603566529492,
            "x": 26.902133713285565,
            "y": 12.762390778512396,
            "angle": -18.66996167689343
        },
        {
            "id": 70,
            "radius": 2.0000002632609353,
            "x": 34.24605084499555,
            "y": 13.872360501377363,
            "angle": -23.367661230482625
        },
        {
            "id": 69,
            "radius": 2.0000003107535083,
            "x": 23.215342554815496,
            "y": 14.311389396919123,
            "angle": -16.279163073574804
        },
        {
            "id": 68,
            "radius": 2.000000788925726,
            "x": 30.78607640003573,
            "y": 11.876105117432777,
            "angle": -17.162038831754682
        },
        {
            "id": 67,
            "radius": 2.0000011513815124,
            "x": 34.24599808759391,
            "y": 9.878892899621649,
            "angle": -17.394424872295613
        },
        {
            "id": 66,
            "radius": 2.068792866941015,
            "x": 5.125152276201303,
            "y": 13.303485889493771,
            "angle": -2.6833482612971142
        },
        {
            "id": 65,
            "radius": 2.0000018683637886,
            "x": 2.1899080985244046,
            "y": 16.113863617997556,
            "angle": -6.703734950075418
        },
        {
            "id": 64,
            "radius": 2.000001808014253,
            "x": 30.78814044331078,
            "y": 7.88155684850687,
            "angle": -22.578850980368962
        },
        {
            "id": 63,
            "radius": 7.761076817558299,
            "x": -6.371057410123997,
            "y": 22.863883402471224,
            "angle": 2.5979342714348563
        },
        {
            "id": 62,
            "radius": 7.399245541838134,
            "x": -17.021103762996262,
            "y": 11.843729898948496,
            "angle": -0.6799624070407853
        },
        {
            "id": 61,
            "radius": 2.000002888845075,
            "x": 6.460010625652755,
            "y": 9.465343678069988,
            "angle": -0.3468752100452824
        },
        {
            "id": 60,
            "radius": 7.286694101508917,
            "x": 13.38921531665424,
            "y": 17.710971345983197,
            "angle": -1.5875160000027648
        },
        {
            "id": 59,
            "radius": 2.000004797549544,
            "x": 34.2465105345655,
            "y": 5.884507227105573,
            "angle": -15.709303080813058
        },
        {
            "id": 58,
            "radius": 1.766735253772291,
            "x": 31.204609095650728,
            "y": 3.6766805559900453,
            "angle": -18.34049095924302
        },
        {
            "id": 57,
            "radius": 2.0000105999251065,
            "x": 34.24599321705129,
            "y": 1.467357237000907,
            "angle": -22.490340862330047
        },
        {
            "id": 56,
            "radius": 2.000018155969363,
            "x": 30.540410279286736,
            "y": -0.025268409120295376,
            "angle": -21.022862306880235
        },
        {
            "id": 55,
            "radius": 2.000017877208283,
            "x": 34.24571480184055,
            "y": -2.5263099208094277,
            "angle": -23.85666638274346
        },
        {
            "id": 54,
            "radius": 2.0000329496388116,
            "x": 11.860626748660707,
            "y": 8.558952667439229,
            "angle": -7.803514172189986
        },
        {
            "id": 53,
            "radius": 7.30943072702332,
            "x": -2.7677133764295343,
            "y": 8.235925322383958,
            "angle": 0.44147496619765014
        },
        {
            "id": 52,
            "radius": 6.095747599451303,
            "x": -30.149256780476122,
            "y": 8.634593980529123,
            "angle": 7.817868232513036
        },
        {
            "id": 51,
            "radius": 4.863545953360768,
            "x": 8.12279707125651,
            "y": 2.811474081442805,
            "angle": -3.5456652361853753
        },
        {
            "id": 50,
            "radius": 8.279492455418382,
            "x": 21.18232981881541,
            "y": 4.240509754140949,
            "angle": -2.3346623982240677
        },
        {
            "id": 49,
            "radius": 2.000118584597173,
            "x": -8.293279874658799,
            "y": 0.3166876675321251,
            "angle": 10.549119240288904
        },
        {
            "id": 48,
            "radius": 2.0001183512513276,
            "x": 21.70361837057445,
            "y": -9.067061144090285,
            "angle": -20.47631813120878
        },
        {
            "id": 47,
            "radius": 5.0828875171467764,
            "x": 28.637625889527605,
            "y": -6.842298752357008,
            "angle": -8.576833995836889
        },
        {
            "id": 46,
            "radius": 1.7580932784636487,
            "x": -4.023666313928593,
            "y": -0.7375946095597098,
            "angle": 7.797994438134835
        },
        {
            "id": 45,
            "radius": 2.000477302678586,
            "x": -29.839508383515664,
            "y": 0.5498919649302071,
            "angle": 21.770894460089096
        },
        {
            "id": 44,
            "radius": 2.0005515727036265,
            "x": -26.12846568257377,
            "y": -0.9281949677067924,
            "angle": 7.03964500917509
        },
        {
            "id": 43,
            "radius": 2.3392661179698218,
            "x": -33.90625753580302,
            "y": -0.9470869991508437,
            "angle": 13.722682305651727
        },
        {
            "id": 42,
            "radius": 2.94039780521262,
            "x": -6.923535954104956,
            "y": -4.4257373035377325,
            "angle": -2.1328953593755124
        },
        {
            "id": 41,
            "radius": 2.1896776406035663,
            "x": -7.341657168434314,
            "y": -9.5323049089288,
            "angle": -7.256676856642396
        },
        {
            "id": 40,
            "radius": 4.753772290809328,
            "x": 0.7278542396252792,
            "y": -5.181921290663257,
            "angle": 0.7774277257576343
        },
        {
            "id": 39,
            "radius": 7.29934842249657,
            "x": -17.035235102687757,
            "y": -2.849300550785404,
            "angle": 3.9334407686343744
        },
        {
            "id": 38,
            "radius": 2.0022236971918597,
            "x": -22.00499630945696,
            "y": -14.00539882043016,
            "angle": 18.626761670023665
        },
        {
            "id": 37,
            "radius": 2.002791723745263,
            "x": -10.765801240760043,
            "y": -11.94072374988291,
            "angle": -18.44227639773562
        },
        {
            "id": 36,
            "radius": 2.0043242933249115,
            "x": -20.15390542339054,
            "y": -17.616870260809467,
            "angle": 14.95065619298329
        },
        {
            "id": 35,
            "radius": 6.62980109739369,
            "x": -29.61533396463588,
            "y": -8.817171309759745,
            "angle": 3.910675412901706
        },
        {
            "id": 34,
            "radius": 2.006419019522905,
            "x": -14.769052028880685,
            "y": -11.865862907121151,
            "angle": 3.050298553883318
        },
        {
            "id": 33,
            "radius": 3.517249657064472,
            "x": -25.64377898444916,
            "y": -18.148820435684133,
            "angle": 8.726029052245188
        },
        {
            "id": 32,
            "radius": 2.009600513235118,
            "x": -18.004958908516905,
            "y": -14.233692946265057,
            "angle": 7.548808689817563
        },
        {
            "id": 31,
            "radius": 2.997290809327846,
            "x": -12.852735812943717,
            "y": -16.478229012292477,
            "angle": 0.36500923885532577
        },
        {
            "id": 30,
            "radius": 7.376200274348422,
            "x": 12.339105665422275,
            "y": -8.672137368257365,
            "angle": 0.19083582310815086
        },
        {
            "id": 29,
            "radius": 2.403257887517147,
            "x": 30.23636852726109,
            "y": -14.148406816149153,
            "angle": -7.861896972182928
        },
        {
            "id": 28,
            "radius": 2.0289529167935214,
            "x": 34.211113263070715,
            "y": -12.084845290913803,
            "angle": -16.767699035720586
        },
        {
            "id": 27,
            "radius": 2.0455176024846815,
            "x": 34.20023494069515,
            "y": -16.154368255284744,
            "angle": -16.16876111543145
        },
        {
            "id": 26,
            "radius": 2.0399862825788753,
            "x": 15.143711912438423,
            "y": -17.982667957135064,
            "angle": -5.119198291135266
        },
        {
            "id": 25,
            "radius": 2.085606856065016,
            "x": 29.841731010346802,
            "y": -18.611856046015596,
            "angle": -13.88923954286868
        },
        {
            "id": 24,
            "radius": 2.089429041119794,
            "x": 9.926247721505884,
            "y": -17.814937794499638,
            "angle": -4.275822495686519
        },
        {
            "id": 23,
            "radius": 5.510048010973937,
            "x": 22.54683581599576,
            "y": -16.527121847778268,
            "angle": -1.7927964747077687
        },
        {
            "id": 22,
            "radius": 2.308193091827185,
            "x": 20.597784230786402,
            "y": -24.09578833845989,
            "angle": -6.194799293897153
        },
        {
            "id": 21,
            "radius": 2.3931292535374107,
            "x": 33.855257135174604,
            "y": -20.57402812340276,
            "angle": -18.036560173591457
        },
        {
            "id": 20,
            "radius": 2.813443072702332,
            "x": -16.62452378501972,
            "y": -20.8878362342689,
            "angle": 2.0433250171594097
        },
        {
            "id": 19,
            "radius": 8.988648834019205,
            "x": -1.1002351155128722,
            "y": -18.79915316620868,
            "angle": -1.9564425213474421
        },
        {
            "id": 18,
            "radius": 1.1453360768175582,
            "x": -0.9834769734753369,
            "y": -35.98869028331998,
            "angle": 9.971515271155681
        },
        {
            "id": 17,
            "radius": 2.6203541464086957,
            "x": -2.1389063071566397,
            "y": -32.408859419418846,
            "angle": 14.22720733549826
        },
        {
            "id": 16,
            "radius": 2.069821673525377,
            "x": -4.124196758489295,
            "y": -36.65248933812228,
            "angle": 4.698408098146394
        },
        {
            "id": 15,
            "radius": 3.3831941752498524,
            "x": -21.980053799423835,
            "y": -23.98965904626429,
            "angle": 19.771795529327896
        },
        {
            "id": 14,
            "radius": 3.867259709112412,
            "x": -32.37795974191953,
            "y": -21.16536968525684,
            "angle": 18.203145252198226
        },
        {
            "id": 13,
            "radius": 4.236286105953732,
            "x": 12.405006328630126,
            "y": -23.624452752160643,
            "angle": -3.4780115510326497
        },
        {
            "id": 12,
            "radius": 1.0299039780521262,
            "x": -35.215096021947886,
            "y": -26.237879037988222,
            "angle": 50.75460055886505
        },
        {
            "id": 11,
            "radius": 1.7236282578875173,
            "x": -6.987523612968577,
            "y": -40.636235876183676,
            "angle": 23.493941756448034
        },
        {
            "id": 10,
            "radius": 5.665989631961075,
            "x": 6.320409139393916,
            "y": -31.429919983926464,
            "angle": 0.46192629752729614
        },
        {
            "id": 9,
            "radius": 5.47073663430165,
            "x": 28.14350688602799,
            "y": -25.96802799593678,
            "angle": 6.810859670052645
        },
        {
            "id": 8,
            "radius": 6.323292325004631,
            "x": 18.26503183561862,
            "y": -32.401128016198825,
            "angle": -4.135300991657627
        },
        {
            "id": 7,
            "radius": 6.414861690217466,
            "x": 29.830286680784912,
            "y": -37.72724512949852,
            "angle": -1.6157233355874552
        },
        {
            "id": 6,
            "radius": 8.247805212620028,
            "x": -12.946693903138469,
            "y": -31.313353278670046,
            "angle": 0.7719768939158843
        },
        {
            "id": 5,
            "radius": 7.104036251113233,
            "x": -29.141105253878383,
            "y": -31.64289939759441,
            "angle": 2.0635141233389405
        },
        {
            "id": 4,
            "radius": 8.727846364883401,
            "x": 2.3763389974666067,
            "y": -45.26726806657039,
            "angle": -1.6617296943012692
        },
        {
            "id": 3,
            "radius": 7.224515669558289,
            "x": -13.50000003609351,
            "y": -46.77057456353375,
            "angle": 1.8913698169304296
        },
        {
            "id": 2,
            "radius": 7.642276757583482,
            "x": 18.736942068975196,
            "y": -46.35296975265873,
            "angle": -2.197991996378508
        },
        {
            "id": 1,
            "radius": 4.975685871056241,
            "x": 31.26940972389851,
            "y": -49.02006507024474,
            "angle": -2.4810985498219913
        },
        {
            "id": 0,
            "radius": 7.632390048492716,
            "x": -28.566974915118696,
            "y": -46.362763917039935,
            "angle": 1.819448685608262
        }
    ];
    // render_.sleep_body_info = [
    //     {
    //         "id": 89,
    //         "radius": 2.000000001334325,
    //         "x": 13.968826399015379,
    //         "y": 35.144708413586464,
    //         "angle": -7.330708488484119
    //     },
    //     {
    //         "id": 88,
    //         "radius": 2.121673525377229,
    //         "x": 17.747443704133282,
    //         "y": 33.51104422446711,
    //         "angle": -8.410403515553073
    //     },
    //     {
    //         "id": 87,
    //         "radius": 2.00000000262591,
    //         "x": 8.673185895248716,
    //         "y": 34.092779996828526,
    //         "angle": -4.69356255427921
    //     },
    //     {
    //         "id": 86,
    //         "radius": 5.638751714677641,
    //         "x": -1.1189112249199327,
    //         "y": 40.808040979258365,
    //         "angle": 0.23493200575202847
    //     },
    //     {
    //         "id": 85,
    //         "radius": 7.036179698216735,
    //         "x": -13.20001327188523,
    //         "y": 36.9905284521539,
    //         "angle": 1.6778520115030071
    //     },
    //     {
    //         "id": 84,
    //         "radius": 2.000000005571254,
    //         "x": -10.907250592279334,
    //         "y": 28.256790725530422,
    //         "angle": 4.82118691611067
    //     },
    //     {
    //         "id": 83,
    //         "radius": 8.442146776406036,
    //         "x": -27.80288688916837,
    //         "y": 31.873993745116472,
    //         "angle": 3.6764299742316693
    //     },
    //     {
    //         "id": 82,
    //         "radius": 2.000000015817777,
    //         "x": -34.245005000939855,
    //         "y": 16.906524168981793,
    //         "angle": 10.075171763633538
    //     },
    //     {
    //         "id": 81,
    //         "radius": 2.0000000120272383,
    //         "x": -13.22139964931753,
    //         "y": 25.002611340988352,
    //         "angle": 9.59791959282112
    //     },
    //     {
    //         "id": 80,
    //         "radius": 5.0788751714677645,
    //         "x": 2.459990903698228,
    //         "y": 30.71135515802438,
    //         "angle": 0.06572450997017676
    //     },
    //     {
    //         "id": 79,
    //         "radius": 2.0000000184905953,
    //         "x": 0.3575452906721758,
    //         "y": 23.959563007887514,
    //         "angle": -0.4618310504921598
    //     },
    //     {
    //         "id": 78,
    //         "radius": 5.632990397805212,
    //         "x": 12.710945803679278,
    //         "y": 27.621253202707994,
    //         "angle": -0.6537111915232836
    //     },
    //     {
    //         "id": 77,
    //         "radius": 2.000000065917234,
    //         "x": 4.205025600021658,
    //         "y": 22.885009869769604,
    //         "angle": -3.528539966056307
    //     },
    //     {
    //         "id": 76,
    //         "radius": 8.779698216735254,
    //         "x": 27.46533190658482,
    //         "y": 28.58233995012316,
    //         "angle": -3.0670442010490007
    //     },
    //     {
    //         "id": 75,
    //         "radius": 2.0000000590488325,
    //         "x": 18.481250543630363,
    //         "y": 22.6347314674258,
    //         "angle": -3.4264848699545496
    //     },
    //     {
    //         "id": 74,
    //         "radius": 2.0000001203169604,
    //         "x": 12.404658011702246,
    //         "y": 19.47416889292139,
    //         "angle": -1.2621635634419002
    //     },
    //     {
    //         "id": 73,
    //         "radius": 2.0000002137772395,
    //         "x": 25.002765893039026,
    //         "y": 18.094435800625423,
    //         "angle": -10.963536215325894
    //     },
    //     {
    //         "id": 72,
    //         "radius": 4.184224965706447,
    //         "x": -5.757426940452581,
    //         "y": 24.844154904707292,
    //         "angle": -0.3413001035006267
    //     },
    //     {
    //         "id": 71,
    //         "radius": 1.9890603566529492,
    //         "x": -11.044378033920504,
    //         "y": 21.666523516550825,
    //         "angle": 4.408172000236928
    //     },
    //     {
    //         "id": 70,
    //         "radius": 2.0000002632609353,
    //         "x": 16.39198874537246,
    //         "y": 19.229837710997792,
    //         "angle": -3.171577276397733
    //     },
    //     {
    //         "id": 69,
    //         "radius": 2.0000003107535083,
    //         "x": 7.995873123897222,
    //         "y": 21.625390516100786,
    //         "angle": 6.024842940722774
    //     },
    //     {
    //         "id": 68,
    //         "radius": 2.000000788925726,
    //         "x": -9.24151842333789,
    //         "y": 18.114233870827775,
    //         "angle": 5.3570467185320645
    //     },
    //     {
    //         "id": 67,
    //         "radius": 2.0000011513815124,
    //         "x": -10.050164349308101,
    //         "y": 14.202249479761633,
    //         "angle": 2.312517801276642
    //     },
    //     {
    //         "id": 66,
    //         "radius": 2.068792866941015,
    //         "x": 21.261559199190003,
    //         "y": 19.675121995637564,
    //         "angle": -3.962193986043466
    //     },
    //     {
    //         "id": 65,
    //         "radius": 2.0000018683637886,
    //         "x": 21.83971933437641,
    //         "y": 15.65456995533046,
    //         "angle": -12.021115507059937
    //     },
    //     {
    //         "id": 64,
    //         "radius": 2.000001808014253,
    //         "x": 8.81753291794007,
    //         "y": 17.71638369033752,
    //         "angle": -4.856815304091882
    //     },
    //     {
    //         "id": 63,
    //         "radius": 7.761076817558299,
    //         "x": -0.29309357155285615,
    //         "y": 14.228047652999676,
    //         "angle": -0.07583547132794471
    //     },
    //     {
    //         "id": 62,
    //         "radius": 7.399245541838134,
    //         "x": 14.282256401774445,
    //         "y": 10.075774740775632,
    //         "angle": 0.8913709555148422
    //     },
    //     {
    //         "id": 61,
    //         "radius": 2.000002888845075,
    //         "x": 21.682558101056692,
    //         "y": 1.746972520477006,
    //         "angle": -12.826943632755828
    //     },
    //     {
    //         "id": 60,
    //         "radius": 7.286694101508917,
    //         "x": 28.95840672603706,
    //         "y": 9.69989061710647,
    //         "angle": -0.6708100429271777
    //     },
    //     {
    //         "id": 59,
    //         "radius": 2.000004797549544,
    //         "x": -1.337700994864656,
    //         "y": 4.535643687122785,
    //         "angle": -2.4647774544054686
    //     },
    //     {
    //         "id": 58,
    //         "radius": 1.766735253772291,
    //         "x": 23.436128922873444,
    //         "y": -1.5813801636064255,
    //         "angle": -12.678691302885277
    //     },
    //     {
    //         "id": 57,
    //         "radius": 2.0000105999251065,
    //         "x": 26.343271681149353,
    //         "y": 0.796759077419539,
    //         "angle": -5.991628004027849
    //     },
    //     {
    //         "id": 56,
    //         "radius": 2.000018155969363,
    //         "x": 34.24602290694792,
    //         "y": 2.0729694434490793,
    //         "angle": -11.194163395599197
    //     },
    //     {
    //         "id": 55,
    //         "radius": 2.000017877208283,
    //         "x": -4.8584957557819495,
    //         "y": -2.6096347248468956,
    //         "angle": -3.7838468512879326
    //     },
    //     {
    //         "id": 54,
    //         "radius": 2.0000329496388116,
    //         "x": -3.2011129014652098,
    //         "y": 1.0127130264598354,
    //         "angle": -0.2374615189370453
    //     },
    //     {
    //         "id": 53,
    //         "radius": 7.30943072702332,
    //         "x": -19.72961286408957,
    //         "y": 18.35461994456699,
    //         "angle": 0.8743537497531942
    //     },
    //     {
    //         "id": 52,
    //         "radius": 6.095747599451303,
    //         "x": -30.149318958384306,
    //         "y": 9.929023558288076,
    //         "angle": 4.765831281833528
    //     },
    //     {
    //         "id": 51,
    //         "radius": 4.863545953360768,
    //         "x": 3.530843865262833,
    //         "y": -0.2918867265643991,
    //         "angle": 0.650965150010619
    //     },
    //     {
    //         "id": 50,
    //         "radius": 8.279492455418382,
    //         "x": -12.9206530130205,
    //         "y": 4.337129785175486,
    //         "angle": -1.1864046670428203
    //     },
    //     {
    //         "id": 49,
    //         "radius": 2.000118584597173,
    //         "x": -11.78455657350678,
    //         "y": -9.130716350855895,
    //         "angle": 5.883574141492217
    //     },
    //     {
    //         "id": 48,
    //         "radius": 2.0001183512513276,
    //         "x": -25.4481221284698,
    //         "y": 2.982664866997758,
    //         "angle": 4.535176562617623
    //     },
    //     {
    //         "id": 47,
    //         "radius": 5.0828875171467764,
    //         "x": -31.16211924333695,
    //         "y": -1.1984426603952554,
    //         "angle": 4.182276479612974
    //     },
    //     {
    //         "id": 46,
    //         "radius": 1.7580932784636487,
    //         "x": 2.1600700148439502,
    //         "y": -6.763451636443673,
    //         "angle": 6.654321647557691
    //     },
    //     {
    //         "id": 45,
    //         "radius": 2.000477302678586,
    //         "x": -24.096305899375476,
    //         "y": -0.7772737543643636,
    //         "angle": 3.219095926068463
    //     },
    //     {
    //         "id": 44,
    //         "radius": 2.0005515727036265,
    //         "x": -11.48149377390933,
    //         "y": -13.109644898026646,
    //         "angle": -0.9470497143505112
    //     },
    //     {
    //         "id": 43,
    //         "radius": 2.3392661179698218,
    //         "x": -1.7788272242448813,
    //         "y": -5.65716282881575,
    //         "angle": -9.31287032972737
    //     },
    //     {
    //         "id": 42,
    //         "radius": 2.94039780521262,
    //         "x": -7.4388629310414816,
    //         "y": -6.806091546332305,
    //         "angle": 4.911188565425926
    //     },
    //     {
    //         "id": 41,
    //         "radius": 2.1896776406035663,
    //         "x": 5.965092402681297,
    //         "y": -7.7917356746789945,
    //         "angle": -3.687457396821018
    //     },
    //     {
    //         "id": 40,
    //         "radius": 4.753772290809328,
    //         "x": -31.49231424191083,
    //         "y": -11.024354378754769,
    //         "angle": 5.191515062402029
    //     },
    //     {
    //         "id": 39,
    //         "radius": 7.29934842249657,
    //         "x": 14.897224819134124,
    //         "y": -4.604654671678368,
    //         "angle": -0.0636801726770903
    //     },
    //     {
    //         "id": 38,
    //         "radius": 2.0022236971918597,
    //         "x": 8.223695980344926,
    //         "y": -11.316263740322633,
    //         "angle": -0.07315884042883568
    //     },
    //     {
    //         "id": 37,
    //         "radius": 2.002791723745263,
    //         "x": 11.674739555226628,
    //         "y": -13.336570314313757,
    //         "angle": -5.234833469215599
    //     },
    //     {
    //         "id": 36,
    //         "radius": 2.0043242933249115,
    //         "x": -13.764923010876005,
    //         "y": -16.386195282594343,
    //         "angle": 0.9929164849858929
    //     },
    //     {
    //         "id": 35,
    //         "radius": 6.62980109739369,
    //         "x": -20.38479130888809,
    //         "y": -8.563115279657103,
    //         "angle": 4.718401832777825
    //     },
    //     {
    //         "id": 34,
    //         "radius": 2.006419019522905,
    //         "x": -34.23858098047711,
    //         "y": -18.090214455849054,
    //         "angle": 20.691037205267136
    //     },
    //     {
    //         "id": 33,
    //         "radius": 3.517249657064472,
    //         "x": 24.624221620397783,
    //         "y": -10.578398037993654,
    //         "angle": 0.3969660268138441
    //     },
    //     {
    //         "id": 32,
    //         "radius": 2.009600513235118,
    //         "x": -16.41605266217535,
    //         "y": -19.386809803081636,
    //         "angle": 9.683236289186116
    //     },
    //     {
    //         "id": 31,
    //         "radius": 2.997290809327846,
    //         "x": 33.24830882441943,
    //         "y": -10.164471054797248,
    //         "angle": -0.5027827194410617
    //     },
    //     {
    //         "id": 30,
    //         "radius": 7.376200274348422,
    //         "x": -25.53324133538898,
    //         "y": -21.583112899850885,
    //         "angle": 4.0068859231342255
    //     },
    //     {
    //         "id": 29,
    //         "radius": 2.403257887517147,
    //         "x": 10.17700040485298,
    //         "y": -17.47484435514437,
    //         "angle": -3.090804491917663
    //     },
    //     {
    //         "id": 28,
    //         "radius": 2.0289529167935214,
    //         "x": 11.88028325477818,
    //         "y": -21.56117040982353,
    //         "angle": -4.756465718204179
    //     },
    //     {
    //         "id": 27,
    //         "radius": 2.0455176024846815,
    //         "x": 25.030623342390392,
    //         "y": -5.036659738255475,
    //         "angle": -2.3528722012644088
    //     },
    //     {
    //         "id": 26,
    //         "radius": 2.0399862825788753,
    //         "x": -11.81701488432792,
    //         "y": -19.92406435461561,
    //         "angle": 8.116352181354523
    //     },
    //     {
    //         "id": 25,
    //         "radius": 2.085606856065016,
    //         "x": 10.634172935560661,
    //         "y": -25.477223481928235,
    //         "angle": -5.553209882376896
    //     },
    //     {
    //         "id": 24,
    //         "radius": 2.089429041119794,
    //         "x": -34.15721357977561,
    //         "y": -25.46582764185281,
    //         "angle": 18.139702622543872
    //     },
    //     {
    //         "id": 23,
    //         "radius": 5.510048010973937,
    //         "x": 18.248474558806645,
    //         "y": -16.96175340600689,
    //         "angle": -2.9389482169755516
    //     },
    //     {
    //         "id": 22,
    //         "radius": 2.308193091827185,
    //         "x": 22.00955688612271,
    //         "y": -24.614869163055406,
    //         "angle": -0.65759836315432
    //     },
    //     {
    //         "id": 21,
    //         "radius": 2.3931292535374107,
    //         "x": -7.330156357233297,
    //         "y": -26.546457771291173,
    //         "angle": 3.854413240159114
    //     },
    //     {
    //         "id": 20,
    //         "radius": 2.813443072702332,
    //         "x": 15.473731461284281,
    //         "y": -24.800166384024454,
    //         "angle": -5.403338883319545
    //     },
    //     {
    //         "id": 19,
    //         "radius": 8.988648834019205,
    //         "x": -1.1984915946795789,
    //         "y": -16.964780776989507,
    //         "angle": -0.48527811444007396
    //     },
    //     {
    //         "id": 18,
    //         "radius": 1.1453360768175582,
    //         "x": -35.103308789302645,
    //         "y": -28.548677309424363,
    //         "angle": 5.57270219826861
    //     },
    //     {
    //         "id": 17,
    //         "radius": 2.6203541464086957,
    //         "x": 5.978427472432911,
    //         "y": -26.07743273701507,
    //         "angle": 8.420795485917344
    //     },
    //     {
    //         "id": 16,
    //         "radius": 2.069821673525377,
    //         "x": 19.18665759653063,
    //         "y": -27.95433591017702,
    //         "angle": 9.949551641430393
    //     },
    //     {
    //         "id": 15,
    //         "radius": 3.3831941752498524,
    //         "x": -10.857569802656949,
    //         "y": -31.112510703784782,
    //         "angle": 3.1564941057356104
    //     },
    //     {
    //         "id": 14,
    //         "radius": 3.867259709112412,
    //         "x": -14.784757693320916,
    //         "y": -25.025233681112045,
    //         "angle": 5.120833124345995
    //     },
    //     {
    //         "id": 13,
    //         "radius": 4.236286105953732,
    //         "x": 31.05558721719017,
    //         "y": -3.2779680598677716,
    //         "angle": -1.6767429370150624
    //     },
    //     {
    //         "id": 12,
    //         "radius": 1.0299039780521262,
    //         "x": 6.679861820998183,
    //         "y": -29.634770754819584,
    //         "angle": -1.8406497144780671
    //     },
    //     {
    //         "id": 11,
    //         "radius": 1.7236282578875173,
    //         "x": 34.5213717421125,
    //         "y": -25.763304925200135,
    //         "angle": -6.223304769403237
    //     },
    //     {
    //         "id": 10,
    //         "radius": 5.665989631961075,
    //         "x": -19.650426340097937,
    //         "y": -33.2171001527577,
    //         "angle": 4.46148904254258
    //     },
    //     {
    //         "id": 9,
    //         "radius": 5.47073663430165,
    //         "x": -30.77515511155555,
    //         "y": -33.539489737141444,
    //         "angle": 4.3797437434542905
    //     },
    //     {
    //         "id": 8,
    //         "radius": 6.323292325004631,
    //         "x": 29.921980423408375,
    //         "y": -18.86491163761261,
    //         "angle": -6.323348508939665
    //     },
    //     {
    //         "id": 7,
    //         "radius": 6.414861690217466,
    //         "x": 12.915331767409494,
    //         "y": -33.66062522241834,
    //         "angle": -2.460528421847028
    //     },
    //     {
    //         "id": 6,
    //         "radius": 8.247805212620028,
    //         "x": 27.997591752098085,
    //         "y": -33.302882407778384,
    //         "angle": -3.012980192034177
    //     },
    //     {
    //         "id": 5,
    //         "radius": 7.104036251113233,
    //         "x": -0.5948783225769493,
    //         "y": -33.235092726635884,
    //         "angle": 1.47934932328886
    //     },
    //     {
    //         "id": 4,
    //         "radius": 8.727846364883401,
    //         "x": -11.788543576573144,
    //         "y": -45.26732255696461,
    //         "angle": 1.6934717324751882
    //     },
    //     {
    //         "id": 3,
    //         "radius": 7.224515669558289,
    //         "x": 4.087388351318164,
    //         "y": -46.770823473916934,
    //         "angle": -0.2506061908809511
    //     },
    //     {
    //         "id": 2,
    //         "radius": 7.642276757583482,
    //         "x": 18.942642597173695,
    //         "y": -46.35330774091704,
    //         "angle": -3.2756122913022816
    //     },
    //     {
    //         "id": 1,
    //         "radius": 4.975685871056241,
    //         "x": 31.269784156423334,
    //         "y": -49.01941578631637,
    //         "angle": -6.724310438456982
    //     },
    //     {
    //         "id": 0,
    //         "radius": 7.632390048492716,
    //         "x": -28.107012010503567,
    //         "y": -46.3626968136162,
    //         "angle": 2.7654737491544776
    //     }
    // ];

    const capturer = new CCapture({ format: 'webm', framerate: physics_.fps });

    p5.preload = () => {
        render_.asset = p5.loadImage("../data/725px-Mona_Lisa,_by_Leonardo_da_Vinci,_from_C2RMF_retouched.jpg");
    };

    p5.setup = () => {
        initPhysics(physics_);
        initRender(p5, render_, physics_);
    };
    p5.draw = () => {
        if (p5.frameCount === 1) { capturer.start(); }
        if (physics_.flag.sleep) {
            p5.noLoop();
            console.log('Recording stop');
            capturer.stop();
            capturer.save();
            return;
        }

        // main
        updatePhysics(physics_);
        updateRender(p5, render_, physics_);

        capturer.capture(document.getElementById('defaultCanvas0'));
    };

    p5.keyPressed = () => {
        if (p5.keyCode === p5.LEFT_ARROW) {
            if (!physics_.flag.sleep && physics_.counter.circle == physics_.counter.maxCircle) {
                console.log("SavePhysics success");
                savePhysics(physics_);
            } else {
                console.log("SavePhysics failure");
            }
        } else if (p5.keyCode === p5.RIGHT_ARROW) {
            console.log("SaveRender success");
            // p5.noLoop();
            // console.log('Recording stop');
            // capturer.stop();
            capturer.save();
        }
    };
};

const canvas = new p5(sketch); 